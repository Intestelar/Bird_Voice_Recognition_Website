<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Automated Bird Species Identification using Audio Signal Processing and Neural Network</title>
    <!-- CSS FILES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">
    <link href="../static/css/bootstrap-icons.css" rel="stylesheet">
    <link href="../static/css/templatemo-leadership-event.css" rel="stylesheet">
    <!-- TemplateMo 575 Leadership Event -->
    <style>
        /* Breathing animation */
        @keyframes breathing {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        .listening-feedback {
            animation: breathing 2s infinite;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a href="index.html" class="navbar-brand mx-auto mx-lg-0">
                <i class="bi-bullseye brand-logo"></i>
                <span class="brand-text" style="font-size: 30px; margin-top: 10px; font-style: italic;text-transform: capitalize;">avi-audio net</span>
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link click-scroll" href="{{url_for('first')}}" style="font-style: italic;">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link click-scroll" href="{{url_for('first')}}" style="font-style: italic;">Login</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <main>
        <section class="contact section-padding" id="section_7">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-12 mx-auto">
                        <form id="audioForm" class="custom-form contact-form bg-white shadow-lg" action="{{ url_for('get_output') }}" method="POST" enctype="multipart/form-data">
                            <center> <h2 style="font-style: italic">Preview</h2> </center>
                            <div class="row">
                                <div class="col-lg-6">
                                    <!-- First input block -->
                                    <div class="limiter">
                                        <div class="container-login100" style="background-image: url(images/background1.jpg); background-size: fill;">
                                            <div class="wrap-login100">
                                                <div class="login100-form-title" style=" background-image: url(images/background2.jpg);">
                                                    <center><span class="login100-form-title-1">
                                                        <h3 class="title-a" style="font-style: italic"> Upload Audio: </h3>
                                                    </span></center>
                                                </div>
                                                <br>
                                             <center>
                                                <div class="col-md-5 col-lg-4">
                                                    <div class="wrap-input100 validate-input m-b-26" data-validate="Username is required">
                                                        <br>
                                                        <input type="file" id="audio_file" style="font-style: italic" name="audio_file" accept=".wav,.mp3,.mp4,.weba,.ogg,.MPEG" required> 
                                                    </div>
                                                </div></center>
                                                <img id="preview">
                                            </div>
                                        </div>
                                    </div> 
                                </div>
                                <div class="col-lg-6">
                                    <!-- Second input block -->
                                    <div style="border-left: 1px solid #ccc; padding-left: 20px;">
                                        <center><h3 class="title-a" style="font-style: italic;">Predict from Live Audio:</h3></center>
                                        <center><button id="startListeningBtn" type="button" style="font-style: italic;">Start Listening</button></center>
                                         <div id="listeningFeedback" class="listening-feedback" style="font-style: italic; display: none;">Listening...</div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <center><button class="login100-form-btn" type="submit" style="font-style: italic"> Submit </button></center>
                            </div>
                            <!-- Separate the input blocks with a margin line -->
                            <hr style="margin: 50px 0;">
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer class="site-footer">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12 col-12 border-bottom pb-5 mb-5">
                    <div class="d-flex"></div>
                </div>
                <div class="col-lg-7 col-12"></div>
                <div class="col-lg-5 col-12 ms-lg-auto">
                    <div class="copyright-text-wrap d-flex align-items-center"></div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Import required JavaScript libraries -->
    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/custom.js"></script>
    <!-- Your custom JavaScript code -->
    <script>
        document.getElementById("startListeningBtn").addEventListener("click", function() {
            var listeningFeedback = document.getElementById("listeningFeedback");

            // Show listening feedback
            listeningFeedback.style.display = "block";

            // Check if the browser supports getUserMedia
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                // Use getUserMedia to capture audio from the user's microphone
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(function(stream) {
                        // Stop listening after 5 seconds
                        setTimeout(function() {
                            // Hide listening feedback
                            listeningFeedback.style.display = "none";
                            // Stop audio capture
                            stream.getTracks().forEach(track => track.stop());
                            // Submit the form
                            document.getElementById("audioForm").submit();
                        }, 5000); // Change the time as needed (in milliseconds)
                    })
                    .catch(function(err) {
                        // Handle errors
                        console.error('Error capturing audio: ' + err);
                    });
            } else {
                // Browser does not support getUserMedia
                console.error('getUserMedia not supported on your browser');
            }
        });
    </script>
</body>
</html>
